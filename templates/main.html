<!-- templates/main.html -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Guardians of the Gallery</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
		<style>
			body {
				background-color: #121212;
				color: #f0f0f0;
			}
			.navbar {
				border-bottom: 2px solid #ff4d4d;
			}
			.form-control-dark {
				background-color: #1e1e1e;
				color: #f0f0f0;
				border: 1px solid #ff4d4d;
			}
			.btn-custom {
				background-color: #ff4d4d;
				color: #fff;
				border: none;
			}
			.btn-custom:hover {
				background-color: #e04343;
			}
			.btn-outline-light {
				color: #ff4d4d;
				border-color: #ff4d4d;
			}
			.btn-outline-light:hover {
				background-color: #ff4d4d;
				color: #000;
			}
			.image-grid {
				table-layout: fixed;
				border-collapse: collapse;
				margin: 0 auto;
			}
			.image-grid td {
				width: 120px;
				height: 120px;
				padding: 5px;
				background-color: #121212;
				vertical-align: middle;
				text-align: center;
				border: none !important;
				position: relative;
			}
			.img-thumbnail {
				background-color: transparent !important;
				width: 100% !important;
				height: 100% !important;
				object-fit: contain;
				border: 2px solid #ff4d4d;
			}
			.img-checkbox {
				position: absolute;
				top: 8px;
				left: 8px;
				width: 18px;
				height: 18px;
				accent-color: #ff4d4d;
				display: none;
			}
			.image-grid td:hover .img-checkbox {
				display: block;
			}
			.img-checkbox:checked {
				display: block !important;
			}
		</style>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
			<span class="navbar-brand">Guardians of the Gallery</span>
			<form action="{{ url_for('logout') }}" method="get" class="ms-auto">
				<button type="submit" class="btn btn-outline-light">Logout</button>
			</form>
		</nav>
		<div class="container py-4"> {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} <div class="mb-3"> {% for category, msg in messages %} <div class="alert alert-{{ category }} text-center">
					{{ msg }}
				</div> {% endfor %} </div> {% endif %} {% endwith %}
			<form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" class="row mb-4 align-items-center">
				<div class="col-8">
					<input type="file" name="image" class="form-control form-control-dark" accept=".jpg,.bmp,.png" required />
				</div>
				<div class="col-4 text-end">
					<button type="submit" class="btn btn-custom"> Upload Image </button>
				</div>
			</form>
			<form id="delete-form" action="{{ url_for('delete') }}" method="post"> {% macro image_cell(cell) -%} <td> {% if cell %} <input type="checkbox" name="delete_ids" value="{{ cell }}" class="img-checkbox" />
					<a href="{{ url_for('serve_image', image_id=cell) }}">
						<img src="{{ url_for('serve_image', image_id=cell) }}" alt="thumb-{{ cell }}" class="img-thumbnail" />
					</a> {% else %} &nbsp; {% endif %}
				</td> {%- endmacro %} <div class="table-responsive mb-3 d-flex justify-content-center">
					<table class="image-grid"> {% for row in image_grid %} <tr> {% for cell in row %} {{ image_cell(cell) }} {% endfor %} </tr> {% endfor %} </table>
				</div>
				<div class="d-flex justify-content-center align-items-center gap-3"> {% if page > 1 %} <a href="{{ url_for('main', page=page-1) }}" class="btn btn-outline-light">&laquo; Prev</a> {% endif %} <span>Page {{ page }} of {{ total_pages }}</span> {% if page < total_pages %} <a href="{{ url_for('main', page=page+1) }}" class="btn btn-outline-light">Next &raquo;</a> {% endif %} </div>
				<div class="d-flex justify-content-center mt-3">
					<button id="delete-btn" type="submit" class="btn btn-danger" style="display: none;"> Delete Selected </button>
				</div>
			</form>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			const deleteBtn = document.getElementById('delete-btn');
			const checkboxes = document.querySelectorAll('.img-checkbox');
			function updateDeleteBtn() {
				const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
				deleteBtn.style.display = anyChecked ? 'block' : 'none';
			}
			checkboxes.forEach(cb => {
				cb.addEventListener('change', updateDeleteBtn);
			});
		</script>
	</body>
</html>
